<!-- Game HUD Overlay -->
<div class="hud-overlay">
  <!-- Game Clock (top right) -->
  <div class="hud-clock-container">
    <div class="hud-clock">
      <div class="hud-clock-time">2:45 PM</div>
    </div>
  </div>

  <!-- Action Buttons (below clock) -->
  <div class="hud-action-buttons">
    <button class="hud-action-button" id="hud-log-btn">
      <img src="{{CDN_ASSETS_URL}}/icons/buttons/log.png" alt="Log" class="hud-action-button-icon">
      <div class="hud-action-tooltip">
        <div class="hud-action-tooltip-content">
          Progress Log - See recent updates and progression details.
        </div>
      </div>
    </button>
    <button class="hud-action-button" id="hud-backpack-btn">
      <img src="{{CDN_ASSETS_URL}}/icons/buttons/backpack.png" alt="Backpack" class="hud-action-button-icon">
      <div class="hud-action-tooltip">
        <div class="hud-action-tooltip-content">
          Backpack - View and manage your backpack and equipment.
        </div>
      </div>
    </button>
    <button class="hud-action-button" id="hud-stats-btn">
      <img src="{{CDN_ASSETS_URL}}/icons/buttons/stats.png" alt="Stats" class="hud-action-button-icon">
      <div class="hud-action-tooltip">
        <div class="hud-action-tooltip-content">
          Stats - View your current character stats.
        </div>
      </div>
    </button>
  </div>

  <!-- Player Status Bars (positioned above hotbar) -->
  <div class="hud-status-container">
    <!-- Health Bar -->
    <div class="hud-health-bar">
      <div class="hud-health-fill health-high" style="width: 75%;"></div>
      <div class="hud-health-text">150 / 200</div>
    </div>
    
    <!-- Experience Bar -->
    <div class="hud-exp-bar">
      <div class="hud-exp-fill" style="width: 60%;"></div>
      <div class="hud-exp-text">Level 12 - 1,200 / 2,000 XP</div>
    </div>
  </div>

  <!-- Crosshair -->
  <div class="hud-crosshair">
    <div class="hud-crosshair-horizontal"></div>
    <div class="hud-crosshair-vertical"></div>
  </div>

  <!-- Hotbar -->
  <div class="hud-hotbar-container">
    <div class="hud-hotbar-grid">
      <!-- Static hotbar slots -->
      <div class="hud-hotbar-slot">
        <div class="hud-hotbar-slot-content">1</div>
      </div>
      <div class="hud-hotbar-slot">
        <div class="hud-hotbar-slot-content">2</div>
      </div>
      <div class="hud-hotbar-slot">
        <div class="hud-hotbar-slot-content">3</div>
      </div>
      <div class="hud-hotbar-slot">
        <div class="hud-hotbar-slot-content">4</div>
      </div>
      <div class="hud-hotbar-slot">
        <div class="hud-hotbar-slot-content">5</div>
      </div>
      <div class="hud-hotbar-slot">
        <div class="hud-hotbar-slot-content">6</div>
      </div>
      <div class="hud-hotbar-slot">
        <div class="hud-hotbar-slot-content">7</div>
      </div>
      <div class="hud-hotbar-slot">
        <div class="hud-hotbar-slot-content">8</div>
      </div>
    </div>
  </div>
</div>

<script>
  // Clock functionality
  const clockTime = document.querySelector('.hud-clock-time');
  let gameTime = { hour: 0, minute: 0 };

  function updateClock() {
    const period = gameTime.hour >= 12 ? 'PM' : 'AM';
    const displayHour = gameTime.hour === 0 ? 12 : gameTime.hour > 12 ? gameTime.hour - 12 : gameTime.hour;
    clockTime.textContent = `${displayHour}:${gameTime.minute.toString().padStart(2, '0')} ${period}`;
  }

  setInterval(() => {
    gameTime.minute++;
    if (gameTime.minute >= 60) {
      gameTime.minute = 0;
      gameTime.hour = (gameTime.hour + 1) % 24;
    }
    updateClock();
  }, 1000);

  // Handle data state
  hytopia.onData(data => {
    if (data.type === 'syncClock') {
      gameTime = { hour: data.hour, minute: data.minute };
      updateClock();
    }

    if (data.type === 'syncExperience') {
      updateExperienceBar(data.level, data.exp, data.currentLevelExp, data.nextLevelExp);
    }

    if (data.type === 'syncHealth') {
      updateHealthBar(data.health, data.maxHealth);
    }

    if (data.type === 'hotbarUpdate') {
      updateHotbarSlot(data.position, data);
    }
  });

  // Hotbar functionality
  const hotbarSlots = document.querySelectorAll('.hud-hotbar-slot');

  function setActiveSlot(index) {
    hotbarSlots.forEach((slot, i) => 
      slot.classList.toggle('hud-hotbar-slot-active', i === index)
    );

    hytopia.sendData({ type: 'setSelectedHotbarIndex', index });
  }

  // Setup hotbar events and initialize
  hotbarSlots.forEach((slot, index) => {
    slot.addEventListener('click', () => setActiveSlot(index));
  });

  document.addEventListener('keydown', (e) => {
    const key = parseInt(e.key);
    if (key >= 1 && key <= 8) setActiveSlot(key - 1);
  });

  // Setup action buttons
  document.getElementById('hud-log-btn').addEventListener('click', () => {
    alert('TODO!');
  });

  document.getElementById('hud-backpack-btn').addEventListener('click', () => {
    window.frontiersRPG.openBackpack();
  });

  document.getElementById('hud-stats-btn').addEventListener('click', () => {
    window.frontiersRPG.openStats();
  });

  setActiveSlot(0);

  // Health bar update function
  function updateHealthBar(health, maxHealth) {
    const healthBar = document.querySelector('.hud-health-fill');
    const healthText = document.querySelector('.hud-health-text');
    
    // Calculate percentage
    const healthPercent = Math.max(0, Math.min(100, (health / maxHealth) * 100));
    
    // Update width
    healthBar.style.width = `${healthPercent}%`;
    
    // Update color class
    healthBar.className = 'hud-health-fill';
    if (healthPercent > 66) {
      healthBar.classList.add('health-high');
    } else if (healthPercent > 33) {
      healthBar.classList.add('health-medium');
    } else {
      healthBar.classList.add('health-low');
    }
    
    // Update text
    healthText.textContent = `${Math.max(0, health)} / ${maxHealth}`;
  }

  // Experience bar update function
  function updateExperienceBar(level, exp, currentLevelExp, nextLevelExp) {
    const expBar = document.querySelector('.hud-exp-fill');
    const expText = document.querySelector('.hud-exp-text');
    
    // Calculate progress within current level
    const currentProgress = exp - currentLevelExp;
    const maxProgress = nextLevelExp - currentLevelExp;
    const expPercent = Math.max(0, Math.min(100, (currentProgress / maxProgress) * 100));
    
    // Update width
    expBar.style.width = `${expPercent}%`;
    
    // Format numbers with abbreviations for large values
    const formatExpNumber = (num) => {
      if (num >= 1000000) return `${(num / 1000000).toFixed(1)}M`;
      if (num >= 1000) return `${(num / 1000).toFixed(1)}K`;
      return num.toString();
    };
    
    // Update text with scalable MMORPG-style formatting
    const currentFormatted = formatExpNumber(currentProgress);
    const maxFormatted = formatExpNumber(maxProgress);
    const percentText = `${Math.round(expPercent)}%`;
    
    expText.textContent = `Level ${level} â€¢ ${currentFormatted}/${maxFormatted} XP (${percentText})`;
  }

  // Hotbar update function
  function updateHotbarSlot(position, itemData) {
    if (position < 0 || position >= 8) return; // Safety check
    
    const slot = hotbarSlots[position];
    const content = slot.querySelector('.hud-hotbar-slot-content');
    
    // Clear existing content
    content.innerHTML = '';
    
    if (itemData.removed) {
      // Show slot number for empty slots
      content.textContent = position + 1;
    } else {
      // Create item icon
      const icon = document.createElement('img');
      icon.src = `{{CDN_ASSETS_URL}}/${itemData.iconImageUri}`;
      icon.alt = 'Item';
      icon.className = 'hud-hotbar-slot-icon';
      content.appendChild(icon);
      
      // Add quantity if greater than 1
      if (itemData.quantity && itemData.quantity > 1) {
        const quantity = document.createElement('div');
        quantity.className = 'hud-hotbar-slot-quantity';
        quantity.textContent = itemData.quantity;
        content.appendChild(quantity);
      }
    }
  }
</script>

<style>
  :root {
    --hud-hotbar-size: 56px;
    --hud-bar-height: 20px;
    --hud-bar-width: 220px;
    --hud-hotbar-gap: 8px;
    --hud-actions-gap: 16px;
    --hud-font: 'Inter', -apple-system, BlinkMacSystemFont, sans-serif;
    --hud-primary: #2a2a2a;
    --hud-secondary: #1e1e1e;
    --hud-border: #444;
    --hud-health: #22c55e;
    --hud-exp: #ffd700;
    --hud-text: #ffffff;
    --hud-text-secondary: #cccccc;
  }

  .hud-overlay {
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    pointer-events: none;
    z-index: 100;
    font-family: var(--hud-font);
    user-select: none;
  }

  /* Status Bars Container (centered above hotbar) */
  .hud-status-container {
    position: absolute;
    bottom: 120px;
    left: 50%;
    transform: translateX(-50%);
    display: flex;
    flex-direction: row;
    gap: 12px;
    pointer-events: auto;
  }

  /* Bar Styles */
  .hud-health-bar,
  .hud-exp-bar {
    position: relative;
    width: var(--hud-bar-width);
    height: var(--hud-bar-height);
    background: rgba(0, 0, 0, 0.6);
    border: 1px solid var(--hud-border);
    border-radius: 8px;
    overflow: hidden;
    box-shadow: 0 1px 4px rgba(0, 0, 0, 0.8), inset 0 1px 2px rgba(0, 0, 0, 0.5);
  }

  .hud-health-fill {
    position: absolute;
    top: 0;
    left: 0;
    height: 100%;
    background: linear-gradient(90deg, var(--hud-health), #16a34a);
    transition: width 0.3s ease;
    box-shadow: inset 0 1px 2px rgba(255, 255, 255, 0.2);
  }

  .hud-health-fill.health-high {
    background: linear-gradient(90deg, #4CAF50, #16a34a);
  }

  .hud-health-fill.health-medium {
    background: linear-gradient(90deg, #FFC107, #f59e0b);
  }

  .hud-health-fill.health-low {
    background: linear-gradient(90deg, #f44336, #dc2626);
  }

  .hud-exp-fill {
    position: absolute;
    top: 0;
    left: 0;
    height: 100%;
    background: linear-gradient(90deg, var(--hud-exp), #f59e0b);
    transition: width 0.5s ease;
    box-shadow: inset 0 1px 2px rgba(255, 255, 255, 0.2);
  }

  .hud-health-text,
  .hud-exp-text {
    position: absolute;
    top: 50%;
    left: 50%;
    transform: translate(-50%, -50%);
    font-size: 12px;
    font-weight: 600;
    color: var(--hud-text);
    text-shadow: 0 1px 2px rgba(0, 0, 0, 0.9);
    white-space: nowrap;
    z-index: 2;
  }

  /* Hotbar Styles */
  .hud-hotbar-container {
    position: absolute;
    bottom: 20px;
    left: 50%;
    transform: translateX(-50%);
    pointer-events: auto;
  }

  .hud-hotbar-grid {
    display: grid;
    grid-template-columns: repeat(8, 1fr);
    gap: var(--hud-hotbar-gap);
    background: linear-gradient(145deg, var(--hud-primary), var(--hud-secondary));
    padding: 12px;
    border: 2px solid var(--hud-border);
    border-radius: 12px;
    box-shadow: 0 4px 16px rgba(0, 0, 0, 0.8), inset 0 1px 0 rgba(255, 255, 255, 0.1);
  }

  .hud-hotbar-slot {
    position: relative;
    width: var(--hud-hotbar-size);
    height: var(--hud-hotbar-size);
    background: rgba(0, 0, 0, 0.6);
    border: 2px solid #333;
    border-radius: 8px;
    display: flex;
    align-items: center;
    justify-content: center;
    cursor: pointer;
    transition: all 0.2s ease;
    overflow: hidden;
    box-shadow: inset 0 2px 4px rgba(0, 0, 0, 0.5);
  }

  .hud-hotbar-slot:hover {
    border-color: #555;
    background: rgba(0, 0, 0, 0.8);
    transform: translateY(-2px);
    box-shadow: inset 0 2px 4px rgba(0, 0, 0, 0.5), 0 4px 12px rgba(0, 0, 0, 0.6);
  }

  .hud-hotbar-slot-active {
    border-color: #cccccc !important;
    background: rgba(255, 255, 255, 0.05) !important;
    box-shadow: inset 0 2px 4px rgba(0, 0, 0, 0.5), 0 0 3px rgba(255, 255, 255, 0.2) !important;
  }

  .hud-hotbar-slot-active .hud-hotbar-slot-content {
    color: #cccccc;
  }

  .hud-hotbar-slot-content {
    position: relative;
    z-index: 2;
    font-size: 14px;
    font-weight: 600;
    color: #888;
    text-shadow: 0 1px 2px rgba(0, 0, 0, 0.8);
    width: 100%;
    height: 100%;
    display: flex;
    align-items: center;
    justify-content: center;
  }

  .hud-hotbar-slot-icon {
    width: 48px;
    height: 48px;
    object-fit: contain;
    image-rendering: pixelated;
    filter: drop-shadow(0 1px 2px rgba(0, 0, 0, 0.8));
  }

  .hud-hotbar-slot-quantity {
    position: absolute;
    bottom: 2px;
    right: 2px;
    background: rgba(0, 0, 0, 0.8);
    color: #ffffff;
    font-size: 10px;
    font-weight: 700;
    padding: 1px 4px;
    border-radius: 3px;
    line-height: 1;
    text-shadow: 0 1px 1px rgba(0, 0, 0, 0.9);
    border: 1px solid rgba(255, 255, 255, 0.2);
    min-width: 12px;
    text-align: center;
  }

  /* Clock Styles */
  .hud-clock-container {
    position: absolute;
    top: 20px;
    right: 20px;
    pointer-events: auto;
  }

  .hud-clock {
    background: linear-gradient(145deg, var(--hud-primary), var(--hud-secondary));
    border: 2px solid var(--hud-border);
    border-radius: 8px;
    padding: 12px;
    box-shadow: 0 2px 8px rgba(0, 0, 0, 0.6), inset 0 1px 0 rgba(255, 255, 255, 0.1);
  }

  .hud-clock-time {
    font-size: 14px;
    font-weight: 600;
    color: var(--hud-text);
    text-shadow: 0 1px 2px rgba(0, 0, 0, 0.9);
    text-align: center;
    font-variant-numeric: tabular-nums;
  }

  /* Crosshair Styles */
  .hud-crosshair {
    position: absolute;
    top: 50%;
    left: 50%;
    transform: translate(-50%, -50%);
    pointer-events: none;
    z-index: 50;
  }

  .hud-crosshair-horizontal,
  .hud-crosshair-vertical {
    position: absolute;
    background: rgba(255, 255, 255, 0.8);
    box-shadow: 0 0 2px rgba(0, 0, 0, 0.8);
  }

  .hud-crosshair-horizontal {
    width: 12px;
    height: 2px;
    top: -1px;
    left: -6px;
  }

  .hud-crosshair-vertical {
    width: 2px;
    height: 12px;
    top: -6px;
    left: -1px;
  }

  /* Mobile Responsive */
  @media (max-width: 768px) {
    :root {
      --hud-hotbar-size: 40px;
      --hud-bar-height: 16px;
      --hud-bar-width: 180px;
      --hud-hotbar-gap: 6px;
    }

    .hud-hotbar-container {
      bottom: 16px;
    }

    .hud-hotbar-grid {
      padding: 8px;
      border-radius: 8px;
    }

    .hud-status-container {
      bottom: 70px;
      gap: 3px;
    }

    .hud-clock-container {
      top: 16px;
      right: 16px;
    }

    .hud-clock {
      padding: 8px;
    }

    .hud-clock-time {
      font-size: 12px;
    }

    .hud-hotbar-slot-content {
      font-size: 12px;
    }

    .hud-hotbar-slot-icon {
      width: 28px;
      height: 28px;
    }

    .hud-hotbar-slot-quantity {
      font-size: 8px;
      padding: 1px 3px;
      bottom: 1px;
      right: 1px;
    }

    .hud-health-text,
    .hud-exp-text {
      font-size: 10px;
    }

    .hud-action-buttons {
      top: 60px;
      right: 16px;
    }

    .hud-action-button-icon {
      width: 24px;
      height: 24px;
    }

    .hud-action-tooltip {
      display: none;
    }

    .hud-crosshair-horizontal {
      width: 8px;
      left: -4px;
    }

    .hud-crosshair-vertical {
      height: 8px;
      top: -4px;
    }
  }

  /* High DPI Displays */
  @media (-webkit-min-device-pixel-ratio: 2), (min-resolution: 192dpi) {
    .hud-health-text,
    .hud-exp-text,
    .hud-hotbar-slot-content {
      text-rendering: optimizeLegibility;
      -webkit-font-smoothing: antialiased;
    }
  }

  /* Action Buttons */
  .hud-action-buttons {
    position: absolute;
    top: 80px;
    right: 20px;
    display: flex;
    flex-direction: column;
    gap: var(--hud-actions-gap);
    pointer-events: auto;
  }

  .hud-action-button {
    position: relative;
    width: var(--hud-hotbar-size);
    height: var(--hud-hotbar-size);
    background: linear-gradient(145deg, var(--hud-primary), var(--hud-secondary));
    border: 2px solid var(--hud-border);
    border-radius: 8px;
    display: flex;
    align-items: center;
    justify-content: center;
    cursor: pointer;
    transition: all 0.2s ease;
    overflow: visible;
    box-shadow: 0 4px 16px rgba(0, 0, 0, 0.8), inset 0 1px 0 rgba(255, 255, 255, 0.1);
    padding: 0;
  }

  .hud-action-button:hover {
    transform: translateY(-2px);
    box-shadow: 0 6px 20px rgba(0, 0, 0, 0.9), inset 0 1px 0 rgba(255, 255, 255, 0.1);
    border-color: #555;
  }

  .hud-action-button:hover .hud-action-tooltip {
    opacity: 1;
    visibility: visible;
    transform: translateX(-8px);
  }

  .hud-action-tooltip {
    position: absolute;
    right: 100%;

    margin-right: 12px;
    opacity: 0;
    visibility: hidden;
    transition: all 0.3s ease;
    z-index: 1000;
    pointer-events: none;
  }

  .hud-action-tooltip-content {
    background: linear-gradient(145deg, var(--hud-primary), var(--hud-secondary));
    border: 2px solid var(--hud-border);
    border-radius: 8px;
    padding: 8px 12px;
    box-shadow: 0 4px 12px rgba(0, 0, 0, 0.8), inset 0 1px 0 rgba(255, 255, 255, 0.1);
    font-size: 11px;
    font-weight: 500;
    color: var(--hud-text);
    text-shadow: 0 1px 2px rgba(0, 0, 0, 0.9);
    white-space: nowrap;
    line-height: 1.3;
    position: relative;
  }

  .hud-action-tooltip-content::after {
    content: '';
    position: absolute;
    top: 50%;
    left: 100%;
    transform: translateY(-50%);
    width: 0;
    height: 0;
    border-top: 8px solid transparent;
    border-bottom: 8px solid transparent;
    border-left: 8px solid var(--hud-border);
  }

  .hud-action-tooltip-content::before {
    content: '';
    position: absolute;
    top: 50%;
    left: 100%;
    transform: translateY(-50%);
    margin-left: -2px;
    width: 0;
    height: 0;
    border-top: 6px solid transparent;
    border-bottom: 6px solid transparent;
    border-left: 6px solid var(--hud-primary);
    z-index: 1;
  }

  .hud-action-button-icon {
    width: 100%;
    height: 100%;
    object-fit: contain;
    opacity: 0.8;
    transition: opacity 0.2s ease;
  }

  .hud-action-button:hover .hud-action-button-icon {
    opacity: 1;
  }
</style>
